# API для сервиса обработки отзывов 
v.1.0

![example workflow](https://github.com/nightriddler/yamdb_final/actions/workflows/yamdb_workflow/badge.svg)


```Django Rest Framework``` ```Nginx``` ```Gunicorn``` ```PostrgreSQL``` ```Docker```

## Групповой проект
Проект разрабатывался командой из 3-х человек.

Моя часть - процесс регистрации и аутентификации пользователя, описание модели `User`, описание прав доступа для всех пользовательских ролей.

## Краткое описание всего проекта:
- Проект собирает отзывы (`Review`) пользователей на произведения (`Titles`). 
- Произведения делятся на категории (`Category`).
- Произведению может быть присвоен жанр (`Genre`). 
- Читатели оставляют к произведениям текстовые отзывы (`Review`) и выставляют произведению рейтинг (оценку в диапазоне от одного до десяти). Из множества оценок высчитывается средняя оценка произведения.

### Пользовательские роли
- Аноним — может просматривать описания произведений, читать отзывы и комментарии.
- Аутентифицированный пользователь (`user`)— может читать всё, как и Аноним, дополнительно может публиковать отзывы и ставить рейтинг произведениям, может комментировать чужие отзывы и ставить им оценки; может редактировать и удалять свои отзывы и комментарии.
- Модератор (`moderator`) — те же права, что и у Аутентифицированного пользователя плюс право удалять и редактировать любые отзывы и комментарии.
- Администратор (`admin`) — полные права на управление проектом и всем его содержимым. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.
- Администратор Django — те же права, что и у роли Администратор.

### Процесс регистрации пользователей
1. Пользователь отправляет POST-запрос с параметром email на `api/v1/auth/email/`.
2. Сервис отправляет письмо с кодом подтверждения (`confirmation_code`) на адрес `email`.
3. Пользователь отправляет POST-запрос с параметрами email и confirmation_code на `api/v1/auth/token/`, в ответе на запрос ему приходит token (JWT-токен).

Эти операции выполняются один раз, при регистрации пользователя. В результате пользователь получает токен и может работать с API, отправляя этот токен с каждым запросом.
После регистрации и получения токена пользователь может отправить PATCH-запрос на `api/v1/users/me/` и заполнить поля в своём профайле (описание полей — в документации).
Если пользователя создаёт администратор (например, через POST-запрос `api/v1/users/`) — письмо с кодом отправлять не нужно.

### Ресурсы API 
- Ресурс `AUTH`: аутентификация.
- Ресурс `USERS`: пользователи.
- Ресурс `TITLES`: произведения, к которым пишут отзывы.
- Ресурс `CATEGORIES`: категории (типы) произведений (например «Фильмы», «Книги», «Музыка»).
- Ресурс `GENRES`: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс `REVIEWS`: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс `COMMENTS`: комментарии к отзывам. Комментарий привязан к определённому отзыву.
Каждый ресурс описан в документации: указаны эндпойнты (адреса, по которым можно сделать запрос), разрешённые типы запросов, права доступа и дополнительные параметры, если это необходимо.

## Развертка проекта в Docker
1. Клонируем репозиторий 
```
git clone https://github.com/nightriddler/infra_sp2.git
```
2. В корневой папке с проектом создаем файл `.env` с переменными окружения:
```
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
```
3. Запускаем docker-compose командой 
```
docker-compose up
```
После этой команды развернётся проект, запущенный через `gunicorn` с базой данных `postgres`.
> Во время работы контейнеров в терминале ведётся лог, и выполнить из этого терминала команды невозможно. Придётся открыть второй терминал, перейти в папку с проектом и выполнять следующие команды оттуда.

4. В корне проекта делаем миграции и собираем статику
```
docker-compose exec web python manage.py makemigrations --noinput
docker-compose exec web python manage.py migrate --noinput
docker-compose exec web python manage.py collectstatic --noinput
```
5. Создаем супер пользователя
```
docker-compose exec web python manage.py createsuperuser
```
6. Заполняем базу начальными данными
```
docker-compose exec web python manage.py loaddata fixtures.json
```
Проверить что все отображается и данные загрузились `http://127.0.0.1/api/v1/`, заполнить своими данными - `http://127.0.0.1/admin/`.
> Чтобы остановить работу контейнеров нужно перейти в корневую папку и выполнить `docker-compose stop`

## Документация
В директории `/static/` доступна документация в формате Redoc. 

Удобно посмотреть можно тут - https://editor.swagger.io/ (а также при запуске проекта, по адресу `http://127.0.0.1/redoc/`).

![2021-07-29_20-44-38](https://user-images.githubusercontent.com/75097575/127532018-ed0a868d-5782-4eae-9b2d-fa1daad6ec4d.png)

## Связаться с автором
>[LinkedIn](http://linkedin.com/in/aizi)

>[Telegram](https://t.me/nightriddler)

>[Портфолио](https://github.com/nightriddler)


